<script>
    $(document).ready(function () {
        // Max attachments
        const max = 20;

        // Add attachment
        $('.add-item').click(
            function (event) {
                event.preventDefault();

                document.getElementById("remove-item-button").style.visibility = "visible";

                // Number of children
                const children = $('#items-form-container').children().length;

                // Update visibility of add attachment button
                if (children + 1 === max) {
                    const button = document.getElementById("add-item-button");
                    // After this operation we increased the number of children by one
                    button.style.visibility = "hidden";
                }

                // Add an image attachment form
                if (max !== children) {
                    const tmplMarkup = $('#item-template').html();
                    const compiledTmpl = tmplMarkup.replace(/__prefix__/g, children);
                    // Add form
                    $('div#items-form-container').append(compiledTmpl);

                    // Update form count
                    $('#id_form-TOTAL_FORMS').attr('value', children + 1);
                }
            });

        // Remove attachment
        $('.remove-item').click(
            function (event) {
                event.preventDefault();

                document.getElementById("add-item-button").style.visibility = "visible";

                // Number of children
                const children = $('#items-form-container').children().length;

                // Update visibility of add attachment button
                if (children - 1 === 0) {
                    const button = document.getElementById("remove-item-button");
                    // After this operation we decreased the number of children by one
                    button.style.visibility = "hidden";
                }

                // Remove last child
                const container = document.getElementById('items-form-container');
                container.removeChild(container.lastElementChild);

                // Update form count
                $('#id_form-TOTAL_FORMS').attr('value', children - 1);
            });
    })
</script>

<script type="text/html" id="item-template">
    <div id="item-__prefix__">
        <table class='table table-borderless'>
            {{ item_forms.empty_form }}
        </table>
    </div>
</script>
